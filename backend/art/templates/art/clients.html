{% extends 'art/base.html' %}

{% block content %}
{% load static %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Search Client</h2>
        <a href="{% url 'children:add_child' %}" class="btn btn-primary">Register Client</a>
    </div>

    <form method="post" class="row g-3 mb-4">
        {% csrf_token %}
        <div class="col-md-4">
            <select name="search_by" class="form-select" required>
                <option value="art_number" {% if request.GET.search_by == "hcc" %}selected{% endif %}>ART Number</option>
                <option value="name" {% if request.GET.search_by == "mother_art" %}selected{% endif %}>Name</option>
            </select>
        </div>
        <div class="col-md-5">
            <input type="text" id='id_search_value' name="query" class="form-control" placeholder="Enter search value" value="{{ request.GET.query }}" required>
        </div>
        <div class="col-md-3">
            <button type="submit" class="btn btn-success w-100"><i class="fas fa-search"></i></button>
        </div>
    </form>

    
    <div class="row g-3">
        <div id="touchpad" class="col-4"></div>
        <div class=" row col-8">
            {% if p %}
                <h4 style="color: darkblue;">{{p}}</h4>
            {% elif message %}
                <h4 style="color: red;">{{ message }}</h4>
            {% else %}
                <h4>Client Not Found</h4>
            {% endif %}
            <div class="card" style="background: rgb(221, 221, 221);">
                <div class="card-body">
                    <h3><i class="fas fa-vial"></i> Viral Load</h3>
                    <table class="table table-striped" id="resultsTable">
                        <thead >
                            <tr>
                                <th>Order Date</th>
                                <th>Result</th>
                                <th>Result Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for result in results%}
                                <tr>
                                    <td>{{ result.order_date}}</td>
                                    <td>{{ result.result }}</td>
                                    <td>{{ result.date_received }}</td>
                                </tr>
                            {% empty %}
                                <tr>
                                    <td colspan="3">No Results found</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="card" style="margin-top: 10px; background: rgb(226, 226, 226);">
                <div class="card-body">
                    <h3><i class="fas fa-calendar-alt text-primary me-2"></i> Visit History</h3>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Vist Date</th>
                                <th>Regimen</th>
                                <th>Next Appointment Date</th>
                            </tr>
                        </thead>
                        <tbody id="visitsbody">
                            {% for visit in visits %}
                            <tr>
                                <td>{{visit.visit_date}}</td>
                                <td>{{visit.regimen}}</td>
                                <td>{{visit.next_outcome_date}}</td>
                            </tr>
                            {% empty %}
                                <tr><td colspan="3">No Visit Found</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

    <script src="{% static 'art/index.js'%}"></script>


{% comment %} <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script> {% endcomment %}
<script src="{% static 'js/functions.js' %}"></script>
<script src="{% static 'art/clients.js' %}"></script>
{% endblock %}
